{%- assign total_qty = 0 -%}
{%- assign selected_variant = null -%}
{%- assign has_stock = false -%}

{%- for variant in product.variants -%}
  {%- if variant.options[color_index] == color -%}
    {%- assign total_qty = total_qty | plus: variant.inventory_quantity -%}
    {%- if variant.inventory_quantity > 0 -%}
      {%- assign has_stock = true -%}
    {%- endif -%}
    {%- if selected_variant == null -%}
      {%- assign selected_variant = variant -%}
    {%- endif -%}
  {%- endif -%}
{%- endfor -%}

{%- capture price_html -%}
  {% if selected_variant %}
    {% render 'price-block', variant: selected_variant %}
  {% else %}
    <span class="price">-</span>
  {% endif %}
{%- endcapture -%}

<button
  class="color-button"
  data-color="{{ color }}"
  data-stock-text="{%- if has_stock -%}{{ 'sections.product_banner.available' | t: default: 'Доступно:' }} {{ total_qty }}{%- else -%}{{ 'sections.product_banner.unavailable' | t: default: 'Недоступно' }}{%- endif -%}"
  data-available="{{ has_stock }}"
  data-price-html="{{ price_html | escape }}"
>
  {{ color }}
</button>
